<link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />

<div id="vanta-bg"></div>
<div id="internetConnectionError" class="fs-2" style="display: none;">Offline-режим недоступен!</div>

<div class="props-modal" style="display: none;">
  <p class="fs-1">Настройки</p>
  <div class="pcontent">
    <div class="d-flex flex-column align-items-stretch" style="height: 85%;">
      <div class="flex-fill ">
        <!-- Tabs navs -->
        <ul class="nav nav-tabs nav-justified mb-3" id="ex1" role="tablist">
          <li class="nav-item" role="presentation">
            <a class="nav-link active" id="ex3-tab-1" data-mdb-toggle="tab" href="#ex3-tabs-1" role="tab"
              aria-controls="ex3-tabs-1" aria-selected="true">Запуск и память</a>
          </li>
          <li class="nav-item" role="presentation">
            <a class="nav-link" id="ex3-tab-2" data-mdb-toggle="tab" href="#ex3-tabs-2" role="tab"
              aria-controls="ex3-tabs-2" aria-selected="false">Персонализация</a>
          </li>
          <li class="nav-item" role="presentation">
            <a class="nav-link" id="ex3-tab-3" data-mdb-toggle="tab" href="#ex3-tabs-3" role="tab"
              aria-controls="ex3-tabs-3" aria-selected="false">О программе</a>
          </li>
        </ul>
        <!-- Tabs navs -->

        <!-- Tabs content -->
        <div class="tab-content" id="ex2-content">
          <div class="tab-pane fade show active" id="ex3-tabs-1" role="tabpanel" aria-labelledby="ex3-tab-1"
            style="overflow: auto;">
            <div class="d-flex justify-content-center align-items-center">
              <div>Выделение памяти (Xmx)</div>
              <div class="flex-fill" style="margin-left: 24px;">
                <input type="number" id="ramInput" class="form-control" min=512 step=512 placeholder="Мбайт" />
              </div>
            </div>
            <div class="d-flex justify-content-center align-items-center" style="margin-top: 10px;">
              <div>Минимальное кол-во памяти (Xms)</div>
              <div class="flex-fill" style="margin-left: 24px;">
                <input type="number" id="minRamInput" class="form-control" min=128 step=128 placeholder="Мбайт" />
              </div>
            </div>
            <div class="d-flex justify-content-center align-items-center" style="margin-top: 10px;">
              <div>Выбор JAVA</div>
              <div class="flex-fill" style="margin-left: 24px;">
                <select id="javaSelect"></select>
              </div>
            </div>
          </div>
          <div class="tab-pane fade" id="ex3-tabs-2" role="tabpanel" aria-labelledby="ex3-tab-2"
            style="overflow: auto;">
            <div class="d-flex justify-content-center align-items-center">
              <div>Задний фон лаунчера</div>
              <div class="flex-fill" style="margin-left: 24px;">
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="bgLauncherMode" id="bgLauncherMode1"
                    value="whitescreen" checked />
                  <label class="form-check-label" for="bgLauncherMode1"> Белый фон </label>
                </div>

                <div class="form-check">
                  <input class="form-check-input" type="radio" name="bgLauncherMode" id="bgLauncherMode2"
                    value="animation" />
                  <label class="form-check-label" for="bgLauncherMode2"> Анимационный эффект </label>
                  <select>
                    <option value="birds">Птицы</option>
                    <option value="particles">Паутина</option>
                    <option value="dots">Точки</option>
                  </select>
                </div>

              </div>
            </div>
          </div>
          <div class="tab-pane fade" id="ex3-tabs-3" role="tabpanel" aria-labelledby="ex3-tab-3"
            style="overflow: auto;">
            <div class="d-flex justify-content-center align-items-center flex-column w-100">
              <div><img src="assets/luckylauncher_logo.png" width=128></div>
              <div class="fs-1 fw-bold" style="margin-top: 4px;">LuckyLauncher</div>
              <div style="margin-top: 4px;" class="version"></div>
            </div>
          </div>
        </div>
        <!-- Tabs content -->
      </div>
      <div><button class="btn btn-primary btn-lg" id="savebtn">Сохранить</button></div>
    </div>
  </div>
</div>

<div class="layout">
  <div class="animate__animated animate__slideInLeft animate__delay-1s animate__fast navigation"
    style="background: rgba(255,255,255,0.8);">
    <ul class="styled">
      <li class="logo">
        <img alt="" src="assets/luckylauncher_logo.png" width=32>
      </li>

      <li title="Домашний экран" class="selected" data-form="home"><span class="material-icons">space_dashboard</span>
      </li>
      <li title="Настройки" data-form="settings"><span class="material-icons">settings</span></li>
      <li title="Открыть консоль" class="non-eventable"
        onclick='require("electron").ipcRenderer.send("createConsole");'><span class="material-icons">terminal</span>
      </li>
      <li title="Сообщить об ошибке" class="non-eventable" data-mdb-toggle="modal" data-mdb-target="#sendMessageModal">
        <span class="material-icons">announcement</span></li>
      <li title="Сообщить об ошибке" class="non-eventable" onclick='shell.openPath(path.resolve("./minecraft"))'>
        <span class="material-icons">folder</span></li>
    </ul>
    <div class="usernav-cont">
      <div class="btn-group mb-2 dropup">
        <div class="usernav-box profile-evnt dropdown-toggle" data-mdb-toggle="dropdown" aria-expanded="false"><img
            alt="" class="circle" src="https://minotar.net/avatar/Steve/38" width=38 height=38></div>
        <ul class="dropdown-menu" style="z-index: 235;">
          <li><a class="dropdown-item disabled fs-6 text-black" id="drop-nickname"></a></li>
          <li><a class="dropdown-item text-danger" id="drop-exitfromacc">Выйти</a></li>
        </ul>
      </div>
    </div>
  </div>
  <div class="content animate__animated animate__fadeIn" id="inshere">
    <div class="main-layout">
      <div class="mpl-socials animate__animated animate__fast animate__delay-2s animate__fadeInDown">
        <div class="d-flex justify-content-evenly align-items-center">
          <button class="btn btn-info" onclick='openn("https://t.me/+RftYv5r38pZmYTVi")'>Telegram</button>
          <button class="btn btn-danger"
            onclick='openn("https://www.youtube.com/channel/UC5nwHXFTn6ozkrJMXFpTZKw")'>YouTube</button>
          <button class="btn btn-primary" onclick="openn('https://discord.gg/QTQE6kSvDB')">Discord</button>
        </div>
      </div>
      <div class="mpl-news">
        <div class="swiper mySwiper animate__animated animate__delay-1s animate__fadeIn" style="margin-top: 16px;">
          <div class="swiper-wrapper"></div>
        </div>
      </div>
      <div class="mpl-servers animate__animated animate__fast animate__delay-1s animate__fadeInRight">
        <div class="card">
          <div class="card-header">Сервера</div>
          <div class="card-body" style="padding: 0;">
            <ul class="list-group list-group-flush" style="overflow: auto; height: 180px;"></ul>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="bottom-content animate__animated animate__fadeInUp animate__delay-1s"
    style="background: rgba(255,255,255,0.8);">
    <div class="h-100 w-100 d-inline-flex justify-content-center align-items-center">
      <div class="flex-fill">
        <div class="btn-group mb-2 dropup" style="margin: 0 !important;">
          <button type="button" class="styled dropdown-toggle" data-mdb-toggle="dropdown" aria-expanded="false">
            Dropup
          </button>
          <ul class="dropdown-menu" style="overflow-y: scroll !important; height: 250px; width: 100%;"></ul>
        </div>
      </div>
      <div>
        <button class="btn btn-primary btn-lg">Играть</button>
      </div>
    </div>
    <div class="ms-c" style="display: none;">
      <div class="mc-icon"><img src="assets/blocks/gold_ore_big.webp" height=64></div>
      <div class="mc-name fs-3"></div>
      <div class="mc-desc"><span></span>
        <div class="progress">
          <div id="downloadpbar" class="progress-bar" role="progressbar" aria-valuenow="75" aria-valuemin="0"
            aria-valuemax="100" style="width: 75%;"></div>
        </div>
      </div>
      <div class="mc-others">
        <div class="d-inline-flex justify-content-center align-items-center">
          <!--<button class="btn btn-danger">Убить игру</button>-->
        </div>
      </div>
    </div>
  </div>
</div>

<script src="js/swiper-bundle.min.js"></script>

<style>
  .main-layout {
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: min-content min-content 1fr;
    grid-auto-columns: 1fr;
    gap: 16px 24px;
    grid-auto-flow: row;
    justify-content: center;
    align-content: center;
    justify-items: center;
    align-items: center;
    grid-template-areas:
      "mpl-socials mpl-socials"
      "mpl-news mpl-news"
      "mpl-servers mpl-servers";
    width: 100%;
    height: 100%;
  }

  .mpl-socials {
    grid-area: mpl-socials;
  }

  .mpl-news {
    grid-area: mpl-news;
  }

  .mpl-servers {
    justify-self: stretch;
    align-self: stretch;
    grid-area: mpl-servers;
  }

  .mpl-idontknow {
    justify-self: stretch;
    align-self: stretch;
    grid-area: mpl-idontknow;
  }


  .swiper {
    width: 840px;
    height: 96px;
  }

  select {
    border: 1px solid #bdbdbd;
    outline: none;
    appearance: none;
    padding-top: 2px;
    padding-bottom: 2px;
    padding: 0.375rem 0.375rem;
    border-radius: 0.25rem;
  }

  select:focus {
    border: 1px solid #bdbdbd;
    outline: none;
    appearance: none;
    padding-top: 4px;
    padding-bottom: 3.28px;
    padding: 0.375rem 0.375rem;
    border-radius: 0.25rem;
  }

  .swiper-slide {
    background: rgb(250, 250, 250);
    padding: 6px 24px;
    border-radius: 10px;
  }

  .news-c {
    display: grid;
    grid-template-columns: 64px 1fr max-content;
    grid-template-rows: max-content 1fr;
    gap: 0em 2em;
    grid-auto-flow: row;
    justify-content: center;
    align-content: center;
    justify-items: center;
    align-items: center;
    grid-template-areas:
      "news-icon news-name news-others"
      "news-icon news-desc news-others";
    width: 100%;
    height: 100%;
    padding: 6px 24px;
  }

  #internetConnectionError {
    width: 100%;
    height: 100%;
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    background: var(--mdb-dark);
    color: white;
    z-index: 2955555555555555555555555555;
  }

  .news-icon {
    grid-area: news-icon;
    color: black;
  }

  .news-name {
    justify-self: start;
    align-self: center;
    grid-area: news-name;
    color: black;
  }

  .news-desc {
    justify-self: stretch;
    align-self: stretch;
    grid-area: news-desc;
    color: black;
  }

  .news-others {
    grid-area: news-others;
  }
</style>

<script>
  var ctheme;
  var currentBgMode;
  var gameTime;
  var gameTimeUpdater;
  var lastStatus;
  var selectVersion;
  const fs = require("fs");
  var MD5 = require("crypto-js/md5");
  const openn = require('open');
  const os = require("os");
  const https = require("https");
  const http = require("http");
  var glob = require("glob");
  const path = require("path");
  const {
    shell
  } = require('electron')

  $.ajaxSetup({
    cache: false
  });
  $(document).ready(function () {
    db.get('gameSettings__lastSelectedVersion', function (err, value) {
      if (err) {
        if (err.name == "NotFoundError") {
          db.put("loginpage__lastSelectedVersion", 0);
        }
        selectVersion = "firstVersion";
      } else {
        selectVersion = value;
      }
    });

    db.get('gameSettings__java', function (err, vallue) {
      if (err) {
        if (err.name == "NotFoundError") {
          console.log("DB ERROR:", err);
        }
      } else {
        javaVersions = findAllJavaVersions();
        $("#javaSelect").html("");
        if (vallue == "default") {
          $("#javaSelect").append("<option selected value='default'>По умолчанию</option>");
        } else {
          $("#javaSelect").append("<option value='default'>По умолчанию</option>");
        }
        g = 0;
        sel = "";
        javaVersions.forEach(function (java) {
          java = java.replace('\\', "/");
          if (java == vallue) {
            sel = " selected";
            g = 1;
          } else {
            sel = "";
          }
          $("#javaSelect").append("<option" + sel + " value='" + java + "'>" + java + "</option>");
        });
        if (g == 0) {
          $("#javaSelect option:nth-child(1)").attr('selected', 'selected');
        }
      }
    });
    totalRAM = require('os').totalmem();
    totalRAM = Math.round(totalRAM / (1024 * 1024));
    $("#ramInput").attr("max", totalRAM);
    db.get('gameSettings__maxMemory', function (err, value) {
      if (err) {
        console.log("DB ERROR:", err);
      } else {
        $("#ramInput").attr("value", value);
      }
    });

    db.get('gameSettings__minMemory', function (err, value) {
      if (err) {
        if (err.name == "NotFoundError") {
          console.log("DB ERROR:", err);
        }
      } else {
        $("#minRamInput").attr("value", value);
      }
    });
    $.ajax({
      url: 'https://google.com',
      method: 'get',
      dataType: 'html',
      timeout: 4000,
      error: function (error) {
        $("#internetConnectionError").show();
      }
    });
    $.get("http://m91237kd.beget.tech/db/servers.json", function (servers) {
      userConsoleLog("[LL]: Loaded servers from http://m91237kd.beget.tech/db/servers.json");
      servers.forEach(function (serv) {
        $(".mpl-servers ul").append('<li class="list-group-item">' + serv + '</li>');
      });
    });
    $("#ex3-tabs-3 .version").html("Версия лаунчера: " + require('electron').ipcRenderer.sendSync("launcherVersion"));
    $.get("https://api.github.com/repos/Seeroy/luckylauncher/releases", function (upd) {
      userConsoleLog("[LL]: Checking for updates");
      if (typeof upd[0] !== "undefined") {
        myversion = require('electron').ipcRenderer.sendSync("launcherVersion");
        if (upd[0].tag_name != myversion) {
          userConsoleLog("[LL]: Found update: " + upd[0].tag_name);
          showMessage("Обновление " + upd[0].tag_name,
            "<p style='color: gray;''>Доступно обновление до версии " +
            upd[0].tag_name + "</p><a href='#' class='text-decoration-none' onclick=openn('" + upd[0].assets[
              0]
            .browser_download_url + "')>Перейти</a>", "Спасибо");
        } else {
          userConsoleLog("[LL]: No updates found");
        }
      } else {
        userConsoleLog("[LL]: No updates found");
      }
    });
    $.get("http://m91237kd.beget.tech/db/news.json", function (news) {
      userConsoleLog("[LL]: Loaded news from http://m91237kd.beget.tech/db/news.json");
      news.forEach(function (post) {
        caption = post.caption;
        text = post.text;
        $(".swiper-wrapper").append(
          '<div class="swiper-slide"><div class="news-c"><div class="news-icon"><span class="material-icons" style="color: rgb(120,120,120); font-size: 48px;">newspaper</span></div><div class="news-name fs-3">' +
          caption + '</div><div class="news-desc text-truncate" style="width: 70%;">' + text +
          '</div><div class="news-others"></div></div></div>'
        );
        var swiper = new Swiper(".mySwiper", {
          slidesPerView: 1,
          spaceBetween: 24
        });
      });
    });
    require('electron').ipcRenderer.sendSync("focusFix");

    require('electron').ipcRenderer.send("collectAllStats");
    require('electron').ipcRenderer.once("collectedStats", function (e, stats) {
      javaVersions = findAllJavaVersions();
      stats["javas"] = javaVersions;
      db.get("loginForm__username", function (err, value) {
        stats["username"] = value;
        console.log(stats);
        $.get("http://m91237kd.beget.tech/savestats.php?savedata=" + encodeURI(JSON.stringify(stats)));
        userConsoleLog("[LL]: Sending statistics");
      });
    });

    require('electron').ipcRenderer.on('downloadProgress', (event, message) => {
      if (message.status == "downloading") {
        if ($(".ms-c").css("display") == "none") {
          $(".bottom-content .d-inline-flex.h-100").fadeOut(200, function () {
            $(".ms-c").fadeIn(200);
          });
        }
        if (message.full__progress != "" && message.full__total != "") {
          perc = Math.round((message.full__progress / message.full__total) * 100);
        } else {
          perc = Math.round((message.cur__progress / message.cur__total) * 100);
        }
        perc_cur = Math.round((message.cur__progress / message.cur__total) * 100);
        $("#downloadpbar").css("width", perc + "%");
        $("#downloadpbar").prop("aria-valuenow", perc);
        $(".mc-desc span").html("Скачивание " + message.cur__name + " (" + perc + "%)");
      } else if (message.status == "starting") {
        if ($(".ms-c").css("display") == "none") {
          $(".bottom-content .d-inline-flex.h-100").fadeOut(200, function () {
            $(".ms-c").fadeIn(200);
          });
        }
        $(".mc-desc").html("Запускаем игру...");
      } else if (message.status == "started") {
        gameTime = 0;
        gameTimeUpdater = setInterval(function () {
          if (lastStatus == "started") {
            gameTime++;
            $(".mc-desc").html("Игра запущена! Время игры: " + convertTime(gameTime));
          }
        }, 1000);
      } else if (message.status == "stopping") {
        $(".mc-desc").html("Игра закрывается...");
        clearInterval(gameTimeUpdater);
        gameTimeUpdater = "";
        gameTime = 0;
      } else if (message.status == "stopped") {
        $(".ms-c").fadeOut(200, function () {
          $(".bottom-content .d-inline-flex.h-100").fadeIn(200);
          $(".mc-desc").html(
            '<span></span><div class="progress"><div id="downloadpbar" class="progress-bar" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" style="width: 75%;"></div></div>'
          );
        });
        clearInterval(gameTimeUpdater);
        gameTimeUpdater = "";
        gameTime = 0;
      }
      lastStatus = message.status;
    })

    $(".mc-others .btn-danger").click(function () {
      userConsoleLog("[LL]: Killing game...");
      require('electron').ipcRenderer.send("killMinecraft");
      clearInterval(gameTimeUpdater);
      gameTimeUpdater = "";
      gameTime = 0;
    });

    $(".props-modal #savebtn").click(function () {
      userConsoleLog("[LL]: Saving settings");
      if ($("#ramInput").val() != "" && $("#minRamInput").val() != "") {
        db.put("theme__bgType", $(".props-modal .form-check-input:checked").eq(0).val());
        db.put("theme__animType", $(".props-modal .form-check select").val());
        reloadThemeFromDB();
        db.put("gameSettings__maxMemory", $("#ramInput").val());
        db.put("gameSettings__minMemory", $("#minRamInput").val());
        db.put("gameSettings__java", $("#javaSelect option:selected").val());
      }
    });
    $(".props-modal .form-check-input").change(function () {
      switch ($(this).eq(0)[0].id) {
        case "bgLauncherMode1":
          $(".props-modal .form-check .form-control-sm").attr("disabled", "disabled");
          $(".props-modal .form-check select").attr("disabled", "disabled");
          break;
        case "bgLauncherMode2":
          $(".props-modal .form-check .form-control-sm").attr("disabled", "disabled");
          $(".props-modal .form-check select").removeAttr("disabled");
          break;
      }
    });
    reloadThemeFromDB();
    $(".navigation ul.styled li:not(.logo):not(.non-eventable)").click(function () {
      if (!$(this).hasClass("selected")) {
        $(".navigation ul.styled  li.selected").removeClass("selected");
        $(this).addClass("selected");
        if ($(this).data("form") == "settings") {
          $(".props-modal").show();
          $(".props-modal").addClass("animate__animated");
          $(".props-modal").addClass("animate__faster");
          $(".props-modal").addClass("animate__slideInRight");
        } else if ($(this).data("form") == "home") {
          $(".props-modal").show();
          animateCSS(".props-modal", "slideOutRight").then(function () {
            $(".props-modal").hide();
          });
        }
      }
    });

    db.get("loginForm__username", function (err, value) {
      $("#drop-nickname").text(value);
    });

    function convertTime(seconds) {
      var seconds = parseInt(seconds, 10)
      var hours = Math.floor(seconds / 3600)
      var minutes = Math.floor((seconds - (hours * 3600)) / 60)
      var seconds = seconds - (hours * 3600) - (minutes * 60)
      if (!!hours) {
        if (!!minutes) {
          return `${hours} ч ${minutes} м ${seconds} с`
        } else {
          return `${hours} м 0 м ${seconds} с`
        }
      }
      if (!!minutes) {
        return `0 ч ${minutes} м ${seconds} с`
      }
      return `0 ч 0 м ${seconds} с`
    }

    $.get("https://launchermeta.mojang.com/mc/game/version_manifest.json", function (data) {
      $.get("http://m91237kd.beget.tech/forge_and_optifine_directs.json", function (data_fo) {
        userConsoleLog("[LL]: Loaded versions");
        var myOptions = [];
        data.versions.forEach(function (element, i) {
          if (element.type == "release") {
            img = "grass_block_side.png"
            $(".bottom-content .dropdown-menu").append(
              '<li data-version-type="vanilla" data-version="' + element.id +
              '"><a class="dropdown-item"><div class="d-inline-flex justify-content-center align-items-center"><img style="border-radius: 4px;" src="assets/blocks/' +
              img + '" width=16 height=16/><span style="margin-left: 6px;">Версия ' +
              element.id +
              '</span></div></a></li>');
            if (typeof data_fo[element.id] !== "undefined") {
              if (typeof data_fo[element.id]["optifine_download"] !== "undefined") {
                img = "gold_ore.png"
                $(".bottom-content .dropdown-menu").append(
                  '<li data-version-type="forge-optifine" data-version="' + element.id +
                  '" data-forge-direct="' + data_fo[element.id].forge_download +
                  '" data-optifine-direct="' + data_fo[element.id].optifine_download +
                  '"><a class="dropdown-item"><div class="d-inline-flex justify-content-center align-items-center"><img style="border-radius: 4px;" src="assets/blocks/' +
                  img +
                  '" width=16 height=16/><span style="margin-left: 6px;">Версия Forge OptiFine ' +
                  element.id +
                  '</span></div></a></li>');
              } else {
                img = "gold_ore.png"
                $(".bottom-content .dropdown-menu").append(
                  '<li data-version-type="forge" data-version="' + element.id +
                  '" data-forge-direct="' + data_fo[element.id].forge_download +
                  '"><a class="dropdown-item"><div class="d-inline-flex justify-content-center align-items-center"><img style="border-radius: 4px;" src="assets/blocks/' +
                  img +
                  '" width=16 height=16/><span style="margin-left: 6px;">Версия Forge ' +
                  element.id +
                  '</span></div></a></li>');
              }
            }
          }
        });
        setTimeout(function () {
          if (selectVersion == "firstVersion") {
            parsed = $.parseHTML($(".bottom-content .dropdown-menu li").eq(0).html());
            $(".bottom-content button.styled").html(parsed[0].innerHTML);
            $(".bottom-content button.styled").data("version-type", $(this).data("version-type"));
            $(".bottom-content button.styled").data("version", $(this).data("version"));
            $(".bottom-content button.styled").data("forge-direct", $(this).data("forge-direct"));
            $(".bottom-content button.styled").data("optifine-direct", $(this).data(
              "optifine-direct"));
            db.put("gameSettings__lastSelectedVersion", $(this).data("version-type") + $(this).data(
              "version"));
          } else {
            rg = false;
            $(".bottom-content .dropdown-menu li").each(function () {
              prs = $(this).data("version-type") + $(this).data("version");
              if (prs == selectVersion) {
                parsed = $.parseHTML($(this).html());
                $(".bottom-content button.styled").html(parsed[0].innerHTML);
                $(".bottom-content button.styled").data("version-type", $(this).data(
                  "version-type"));
                $(".bottom-content button.styled").data("version", $(this).data("version"));
                $(".bottom-content button.styled").data("forge-direct", $(this).data(
                  "forge-direct"));
                $(".bottom-content button.styled").data("optifine-direct", $(this).data(
                  "optifine-direct"));
                db.put("gameSettings__lastSelectedVersion", $(this).data("version-type") + $(this)
                  .data(
                    "version"));
                rg = true;
              }
            });
            if (rg == false) {
              selectVersion = "firstVersion";
              parsed = $.parseHTML($(".bottom-content .dropdown-menu li").eq(0).html());
              $(".bottom-content button.styled").html(parsed[0].innerHTML);
              $(".bottom-content button.styled").data("version-type", $(this).data("version-type"));
              $(".bottom-content button.styled").data("version", $(this).data("version"));
              $(".bottom-content button.styled").data("forge-direct", $(this).data("forge-direct"));
              $(".bottom-content button.styled").data("optifine-direct", $(this).data(
                "optifine-direct"));
              db.put("gameSettings__lastSelectedVersion", $(this).data("version-type") + $(this).data(
                "version"));
            }
          }
          $(".bottom-content .dropdown-menu li").click(function () {
            parsed = $.parseHTML($(this).html());
            $(".bottom-content button.styled").html(parsed[0].innerHTML);
            $(".bottom-content button.styled").data("version-type", $(this).data("version-type"));
            $(".bottom-content button.styled").data("version", $(this).data("version"));
            $(".bottom-content button.styled").data("forge-direct", $(this).data("forge-direct"));
            $(".bottom-content button.styled").data("optifine-direct", $(this).data(
              "optifine-direct"));
            db.put("gameSettings__lastSelectedVersion", $(this).data("version-type") + $(this).data(
              "version"));
            selectVersion = $(this).data("version-type") + $(this).data(
              "version");
          });
        }, 700);

        $(".bottom-content .d-inline-flex.h-100 .btn-primary").click(function () {
          vtype = $(".bottom-content button.styled").data("version-type");
          mcVersion = $(".bottom-content button.styled").data("version");
          minRam = $("#minRamInput").val();
          maxRam = $("#ramInput").val();
          authCredetinals = getAuthCredetinalsByUsername($("#drop-nickname").html());
          javaPath = $("#javaSelect option:selected").val();
          if ($(".ms-c").css("display") == "none") {
            $(".bottom-content .d-inline-flex.h-100").fadeOut(200,
              function () {
                $(".ms-c").fadeIn(200);
              });
          }
          $("#downloadpbar").css("width", "0%");
          $("#downloadpbar").prop("aria-valuenow", "0");
          $(".mc-desc span").html("Пытаемся запустить игру...");
          userConsoleLog("[LL]: Trying to start game using MCLC");
          switch (vtype) {
            case "vanilla":
              $(".ms-c .mc-name").html("Minecraft " + mcVersion);
              $(".ms-c .mc-icon img").prop("src", "assets/blocks/grass_block_big.webp");
              opts = launcherOptionsGenerator(mcVersion, "release", authCredetinals, minRam, maxRam,
                javaPath, "");
              launchMinecraft(opts);
              break;
            case "forge":
              $(".ms-c .mc-name").html("Minecraft Forge " + mcVersion);
              $(".ms-c .mc-icon img").prop("src", "assets/blocks/gold_ore_big.webp");
              forgeLink = $(".bottom-content button.styled").data("forge-direct");
              $(".mc-desc span").html("Скачиваем Forge...");
              url = new URL(forgeLink);
              optionsDL = {
                hostname: url.hostname,
                path: url.path
              }
              downloadFile(optionsDL, "./minecraft/LL_downloads/", "https", function (forgePath) {
                userConsoleLog("[LL]: Forge downloaded");
                opts = launcherOptionsGenerator(mcVersion, "release", authCredetinals, minRam,
                  maxRam,
                  javaPath, forgePath);
                launchMinecraft(opts);
              });
              break;
            case "forge-optifine":
              $(".ms-c .mc-name").html("Minecraft ForgeOptiFine " + mcVersion);
              $(".ms-c .mc-icon img").prop("src", "assets/blocks/gold_ore_big.webp");
              forgeLink = $(".bottom-content button.styled").data("forge-direct");
              optifineLink = $(".bottom-content button.styled").data("optifine-direct");
              $(".mc-desc span").html("Скачиваем Forge...");
              url = new URL(forgeLink);
              optionsDL = {
                hostname: url.hostname,
                path: url.pathname
              }
              downloadFile(optionsDL, "./minecraft/LL_downloads/", "https", function (forgePath) {
                userConsoleLog("[LL]: Forge downloaded");
                $(".mc-desc span").html("Скачиваем OptiFine...");
                glob("./minecraft/mods/OptiFine*", function (er, files) {
                  fs.mkdirSync("./minecraft/libraries/luckylauncher/optifines", {
                    recursive: true
                  });
                  files.forEach(function (file) {
                    fs.renameSync(file,
                      "./minecraft/libraries/luckylauncher/optifines/" +
                      path
                      .basename(file));
                  });
                  fs.mkdirSync("./minecraft/libraries/luckylauncher/optifines", {
                    recursive: true
                  });
                  glob("./minecraft/libraries/luckylauncher/optifines/OptiFine*",
                    function (er,
                      files) {
                      needsdown = true;
                      files.forEach(function (file) {
                        if (path.basename(file).toString().search(mcVersion) != -
                          1) {
                          fs.renameSync(
                            "./minecraft/libraries/luckylauncher/optifines/" +
                            path
                            .basename(file), "./minecraft/mods/" + path.basename(
                              file));
                          needsdown = false;
                        }
                      });
                      if (needsdown == true) {
                        url = new URL(optifineLink);
                        optionsDL = {
                          hostname: url.hostname,
                          path: url.pathname
                        }
                        downloadFile(optionsDL, "./minecraft/mods/", "http",
                          function () {
                            userConsoleLog("[LL]: OptiFine downloaded");
                            opts = launcherOptionsGenerator(mcVersion, "release",
                              authCredetinals,
                              minRam,
                              maxRam,
                              javaPath, forgePath);
                            launchMinecraft(opts);
                          });
                      } else {
                        opts = launcherOptionsGenerator(mcVersion, "release",
                          authCredetinals,
                          minRam,
                          maxRam,
                          javaPath, forgePath);
                        launchMinecraft(opts);
                      }
                    });
                });
              });
              break;
          }
        });
      });
    });
  });
</script>

<style>
  .ms-c {
    display: grid;
    grid-template-columns: 64px 1fr max-content;
    grid-template-rows: max-content 1fr;
    gap: 0em 3em;
    grid-auto-flow: row;
    justify-content: center;
    align-content: center;
    justify-items: center;
    align-items: center;
    grid-template-areas:
      "mc-icon mc-name mc-others"
      "mc-icon mc-desc mc-others";
    width: 100%;
    height: 100%;
  }

  .mc-icon {
    grid-area: mc-icon;
  }

  .mc-name {
    justify-self: start;
    align-self: center;
    grid-area: mc-name;
  }

  .mc-desc {
    justify-self: stretch;
    align-self: stretch;
    grid-area: mc-desc;
  }

  .mc-others {
    grid-area: mc-others;
  }

  .whitebg-zapas {
    background: white;
    width: 150%;
    height: 150%;
    z-index: -5;
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
  }

  .props-modal {
    width: calc(100% - 100px);
    height: 100%;
    z-index: 10;
    position: absolute;
    left: 100px;
    top: 0;
    bottom: 0;
    right: 0;
    background: white;
    padding: 24px;
  }

  .props-modal .pcontent {
    padding: 0 10px;
  }

  #vanta-bg {
    width: 100%;
    height: 100%;
    z-index: -50;
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
  }

  .layout {
    display: grid;
    grid-template-columns: 100px 1fr;
    grid-template-rows: 1fr 100px;
    gap: 0px 0px;
    width: 100%;
    height: 100%;
    grid-auto-flow: row;
    grid-template-areas:
      "navigation content"
      "navigation bottom-content";
    background: transparent;
  }

  .navigation {
    grid-area: navigation;
    border-right: 1px solid #ebebeb;
  }

  .content {
    grid-area: content;
    padding: 24px;
  }

  .bottom-content {
    border-top: 1px solid #ebebeb;
    grid-area: bottom-content;
    padding: 16px;
  }

  .navigation ul.styled {
    display: flex;
    box-orient: vertical;
    box-direction: normal;
    flex-direction: column;
    margin: 0;
    padding: 0;
  }

  .navigation ul.styled li {
    list-style: none;
    cursor: pointer;
  }

  .navigation .material-icons {
    cursor: pointer;
  }

  .navigation .logo {
    margin-bottom: 1rem;
    height: 80px;
    display: flex;
    align-items: center;
    box-pack: center;
    box-align: center;
    justify-content: center;
    padding: 15px 0;
    position: relative;
  }

  .navigation ul.styled li:not(.logo) {
    margin: 5px 20px;
    background: white;
    display: flex;
    align-items: center;
    box-pack: center;
    box-align: center;
    justify-content: center;
    border-radius: 5px;
    height: 48px;
  }

  .navigation .selected {
    background: #e6e6e6 !important;
  }

  .navigation .selected .material-icons {
    color: #007bff;
  }

  .navigation ul.styled li i:hover {
    color: #007bff;
  }

  .navigation .usernav-cont {
    display: flex;
    flex-flow: column nowrap;
    justify-content: flex-end;
    align-items: center;
    align-content: center;
    height: 60%;
    width: 100px;
  }

  .navigation .usernav-box {
    flex: 0 1 auto;
    cursor: pointer;
  }

  .bottom-content button.styled {
    border: 0;
    outline: 0;
    appearance: none;
    background-color: var(--mdb-gray-200);
    border-radius: 6px;
    padding: 8px 8px;
    margin: 0;
    width: 100%;
    font-family: inherit;
    font-size: inherit;
    cursor: inherit;
    line-height: inherit;
    width: 100%;
    height: 45px;
    box-shadow: none;
    text-align: left;
    color: black;
  }

  .bottom-content .btn-group {
    width: calc(100% - 24px);
    box-shadow: none;
  }
</style>